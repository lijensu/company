<!DOCTYPE html>
<html>

  <head>
    <title>公司大小事</title>
    <meta charset='utf-8' />
    <script src="components/platform/platform.js"></script>
    
    <link rel="import" href="components/core-icon/core-icon.html">
  <link rel="import" href="components/core-icons/core-icons.html">
  <link rel="import" href="components/core-icons/iconsets/icons.html">
  <link rel="import" href="components/core-toolbar/core-toolbar.html">
  <link rel="import" href="components/core-pages/core-pages.html">
  <link rel="import" href="components/core-item/core-item.html">
  <link rel="import" href="components/core-header-panel/core-header-panel.html">

  <link rel="import" href="components/font-roboto/roboto.html">

  <link rel="import" href="components/paper-tabs/paper-tabs.html">
  <link rel="import" href="components/paper-icon-button/paper-icon-button.html">
  <link rel="import" href="components/paper-item/paper-item.html">
  
  <link rel="import" href="components/sortable-table/sortable-table.html">
  
  <link rel="import" href="components/polymer/polymer.html">
  
  <link rel="import" href="components/core-scaffold/core-scaffold.html">
  <link rel="import" href="components/core-menu/core-menu.html">
  <link rel="import" href="components/core-menu/core-submenu.html">
  
  <link rel="import" href="components/paper-ripple/paper-ripple.html">
  
  <link rel="import" href="components/core-ajax/core-ajax.html">
  
  <style shim-shadowdom>
    body {
      font-family: RobotoDraft, 'Helvetica Neue', Helvetica, Arial;
      color: #333;
      font-size: 14px;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: rgba(0,0,0,0);
      -webkit-touch-callout: none;
    }
    
    paper-tabs, core-toolbar {
      background-color: #00bcd4;
      color: #fff;
      box-shadow: 0px 3px 2px rgba(0, 0, 0, 0.2);
    }
    
    core-toolbar paper-tabs {
      box-shadow: none;
    }
    
    paper-tabs[noink][nobar] paper-tab.core-selected {
      color: #ffff8d;
    }
    
    paper-tabs.transparent-teal {
      background-color: transparent;
      color: #00bcd4;
      box-shadow: none;
    }
    
    paper-tabs.transparent-teal paper-tab::shadow #ink {
      color: #00bcd4;
    }
    
    core-item.core-selected {
      color: red;
    }
    
    core-submenu::shadow #submenu {
      margin-left: 40px;
    }
    
    /* Button */
    .button {
      display: inline-block;
      position: relative;
      width: 50px;
      height: 50px;
      line-height: 50px;
      border-radius: 2px;
      font-size: 1.6em;
      background-color: #fff;
      color: #646464;
    }
    .button.blue {
      background-color: #4285f4;
      color: #fff;
    }
    .center {
      text-align: center;
    }
    .button.raised {
      transition: box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      transition-delay: 0.2s;
      box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
    }
    .button.raised:active {
      box-shadow: 0 8px 17px 0 rgba(0, 0, 0, 0.2);
      transition-delay: 0s;
    }
  </style>
  </head>

<body unresolved fullbleed layout vertical>

  <core-ajax id="memberAjax" url="json/member.json" handleAs="json"></core-ajax>
  <core-ajax id="settingAjax" url="json/setting.json" handleAs="json"></core-ajax>

  <core-scaffold id="scaffold">
    <core-header-panel navigation flex mode="seamed">
      <core-toolbar>
      	ToolBar~
      </core-toolbar>
      <core-menu selected="0" selectedindex="0">
        <core-item icon="forward" label="1"></core-item>
        <core-item icon="forward" label="2"></core-item>
        <core-item icon="forward" label="3"></core-item>
        <core-submenu icon="add" label="open">
	      <core-item icon="forward" label="One"></core-item>
	      <core-item icon="forward" label="Two"></core-item>
	      <core-item icon="forward" label="Three"></core-item>
	    </core-submenu>
      </core-menu>
      
      
    </core-header-panel>
    <div id="toolBar" tool></div>
    <core-pages selected="0">
      <div>
      	<core-item label="這什麼怪東西1!"></core-item>
      </div>		
      <div>
      	<core-item label="這什麼怪東西2!"></core-item>
      </div>
      <div>
      	<core-item label="這什麼怪東西3!"></core-item>
      </div>
	  <div>
	    One...
	  </div>
	  <div>
	    Two...
	  </div>
	  <div>
	    Three...
	  </div>
    </core-pages>
  </core-scaffold>
</body>

<script>
  var deployMember;
  var deployMemberLast;
  var deployMemberNext;
  var members;
  var setting;
  var deployLoopCount = 0;
  window.addEventListener('polymer-ready', function(e) {
    document.querySelector('core-menu').addEventListener('core-activate', function(e) {
	  var menu = document.querySelector('core-menu');
	  var submenu = menu.querySelector('core-submenu');
	  var pages = document.querySelector('core-pages');
	  var drawerPanel = document.querySelector('core-scaffold').shadowRoot.querySelector('#drawerPanel');
		
	  var selectedItem = menu.querySelector('core-item.core-selected');
	  var menuItems = menu.querySelectorAll('core-item');
	  var index = [].indexOf.call(menuItems, selectedItem);
	  if(index >= 0){
		pages.selected = index;
		drawerPanel.closeDrawer();
	  }
	});
  
    var memberAjax = document.querySelector('#memberAjax');
    var settingAjax = document.querySelector('#settingAjax');
    memberAjax.addEventListener('core-response', function(e) {
      members = e.detail.response;
      for (var i = 0; i < members.length; i++) {
        var member = members[i];
        if(member.deploy != -1){
          deployLoopCount++;
        }
      }
      var date1 = new Date(2014,7,10);
      //var date2 = new Date(2014,7,25);
      var date2 = new Date();
      var tmp = date2.getTime()-date1.getTime();
      var day = Math.floor(tmp/1000/60/60/24);
      var shiftNumer = Math.floor((day-1)/7);
      var memberIndex = (setting.deploy+shiftNumer)%deployLoopCount;
      for (var i = 0; i < members.length; i++) {
        var member = members[i];
        if(member.deploy == memberIndex){
          deployMember = member;
  	      if(memberIndex == 0){
  	        deployMemberLast = members[deployLoopCount-1];
  	      }else{
  	        deployMemberLast = members[memberIndex-1];
  	      }
  	      if(memberIndex == (deployLoopCount-1)){
  	        deployMemberNext = members[0];
  	      }else{
  	        deployMemberNext = members[memberIndex+1];
  	      }
        }
      }
      toolBar = document.querySelector('#toolBar');
      toolBar.innerHTML = '上週部版為 : '+deployMemberLast.name + ', '
      + '本週部版為 : ' +deployMember.name + ', '
      + '下週部版為 : ' +deployMemberNext.name;
    });
    settingAjax.addEventListener('core-response', function(e) {
      setting = e.detail.response;
      memberAjax.go(); 
    });
    settingAjax.go(); 
  });
</script>
</html>
